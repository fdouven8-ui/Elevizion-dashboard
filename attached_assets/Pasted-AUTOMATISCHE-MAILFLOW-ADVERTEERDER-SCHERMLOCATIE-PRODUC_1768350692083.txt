AUTOMATISCHE MAILFLOW â€” ADVERTEERDER & SCHERMLOCATIE (PRODUCTIEKLAAR)

CONTEXT
Het volledige onboarding-, upload- en publish-systeem werkt.
Nu moeten op vaste momenten AUTOMATISCH mails worden gestuurd:
- naar de klant (adverteerder / schermlocatie)
- intern naar info@elevizion.nl
Zonder dubbele mails, met juiste inhoud per status, en altijd consistent met contract, upload en publish status.

DOEL
Implementeer een centrale, betrouwbare mailflow die:
- exact 1 mail per statuswijziging stuurt
- de juiste content toont (linkKey, uploadlink, duur, locaties)
- onderscheid maakt tussen adverteerder en schermlocatie
- gebruik maakt van Postmark/no-reply@elevizion.nl
- volledig traceerbaar is (logging)

BELANGRIJK
- Nooit mails versturen op page-loads, alleen op status transitions.
- Nooit dubbele mails bij retries (idempotent).
- Alle mails moeten data halen uit de database (single source of truth).

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A) MAIL EVENTS (ENIGE TOEGESTANE TRIGGERS)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Implementeer een MailEvent dispatcher die alleen triggert op deze transitions:

ADVERTEERDER
1) CONTRACT_ACCEPTED
2) ASSET_UPLOADED_VALID
3) PUBLISHED (LIVE)

SCHERMLOCATIE
4) LOCATION_INTAKE_SUBMITTED
5) LOCATION_APPROVED
6) LOCATION_CONTRACT_ACCEPTED

Geen andere triggers toegestaan.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
B) MAILS PER EVENT (INHOUD)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1) ADVERTEERDER â€” CONTRACT_ACCEPTED
TO:
- klant (primary)
- intern CC: info@elevizion.nl (optioneel)

ONDERWERP:
"Volgende stap: upload je advertentie voor Elevizion"

INHOUD (verplicht):
- Bedankje
- Uploadlink (token-based)
- LinkKey (copy-friendly blok)
- Bestandsnaam voorbeeld:
  {{linkKey}}_{{companyName}}.mp4
- Lengte:
  "Lengte: exact {{videoDurationSeconds}} seconden (tenzij anders overeengekomen in contract)"
- Type:
  "MP4 aanbevolen"
- Call to action: â€œUpload je advertentieâ€

2) ADVERTEERDER â€” ASSET_UPLOADED_VALID
TO:
- intern: info@elevizion.nl
- (optioneel) klant bevestiging

ONDERWERP (intern):
"Nieuwe advertentie klaar voor plaatsing â€” {{companyName}}"

INHOUD:
- Bedrijfsnaam
- LinkKey
- Video specs (duur, resolutie)
- Link naar dashboard (advertiser detail / publish queue)

OPTIONEEL klant:
"Je advertentie is ontvangen en wordt nu voorbereid voor plaatsing."

3) ADVERTEERDER â€” PUBLISHED (LIVE)
TO:
- klant

ONDERWERP:
"Je advertentie staat live bij Elevizion ğŸ‰"

INHOUD:
- Bevestiging livegang
- Aantal locaties
- Regio(â€™s)
- Verwachte zichtbaarheid (indicatief, geen garantie)
- Call to action:
  â€œVragen? Mail info@elevizion.nlâ€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SCHERMLOCATIE MAILS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

4) SCHERMLOCATIE â€” LOCATION_INTAKE_SUBMITTED
TO:
- schermlocatie

ONDERWERP:
"Aanmelding ontvangen â€” Elevizion schermlocatie"

INHOUD:
- Bevestiging ontvangst
- Uitleg: beoordeling volgt
- Geen contract of actie nodig

5) SCHERMLOCATIE â€” LOCATION_APPROVED
TO:
- schermlocatie

ONDERWERP:
"Goedkeuring locatie â€” bevestig je deelname"

INHOUD:
- Bevestiging goedgekeurd
- Contract link (token-based)
- Korte uitleg volgende stap

6) SCHERMLOCATIE â€” LOCATION_CONTRACT_ACCEPTED
TO:
- schermlocatie
- intern: info@elevizion.nl

ONDERWERP:
"Schermlocatie bevestigd â€” Elevizion"

INHOUD:
- Bevestiging akkoord
- Samenvatting afspraken
- Wat er nu gebeurt (installatie / activatie)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
C) TECHNISCHE IMPLEMENTATIE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1) MailService:
- sendMail(eventType, entityId)
- bepaalt template + ontvangers + variabelen

2) Idempotency:
- Maak MailLog tabel:
  - eventType
  - entityId
  - sentAt
- Voor verzending:
  - check of mail al is verzonden
  - zo ja: skip

3) Afzender:
- From: no-reply@elevizion.nl
- Reply-to: info@elevizion.nl

4) Templates:
- Gebruik HTML + plain text fallback
- Zet templates centraal (MailTemplate store)
- Variabelen:
  {{companyName}}, {{linkKey}}, {{uploadLink}}, {{videoDurationSeconds}},
  {{locationCount}}, {{regions}}, {{dashboardLink}}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
D) DASHBOARD & HEALTH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Toon in advertiser & locatie detail:
  - â€œLaatste mail verstuurd opâ€¦â€
- System Health:
  - Check â€œMail events enabledâ€
  - Check â€œNo duplicate mail logsâ€
- Logging:
  - success/fail per mail (geen retry loops zonder delay)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
E) OUTPUT / ACCEPTATIE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Na implementatie wil ik:
1) Lijst met mail events + bijbehorende templates
2) Waar MailLog wordt opgeslagen
3) Bewijs dat mails 1x per status worden verzonden
4) Testflow:
   - contract accept â†’ mail
   - upload valid â†’ interne mail
   - publish â†’ live mail
   - schermlocatie intake â†’ bevestiging

IMPLEMENT NOW â€” NO QUESTIONS, NO PLACEHOLDERS.

**Context**
Bij â€œAkkoord & publiceerâ€ faalt de upload naar Yodeck met:
HTTP 400 â€“ Unsupported media type `text/plain; charset=UTF-8`.

Dit betekent dat de backend momenteel gÃ©Ã©n correcte binary video upload verstuurt (waarschijnlijk wordt een string, JSON of verkeerde stream doorgegeven i.p.v. een multipart/form-data of raw video stream).

---

## DOEL

1. Video upload naar Yodeck moet altijd als **binary video/mp4** gebeuren
2. Correcte **Content-Type + boundary** gebruiken
3. Upload moet **idempotent** zijn (retry veilig)
4. Duidelijke foutmelding + retry mogelijkheid in UI

---

## 1ï¸âƒ£ FIX: Yodeck media upload (CRITISCH)

Zoek de Yodeck upload code (bv. `yodeckPublishService.ts`).

### âŒ Huidig probleem (waarschijnlijk)

* `fetch()` of `axios.post()` stuurt:

  * string
  * JSON
  * of verkeerde body zonder multipart boundary

### âœ… Oplossing (verplicht)

Gebruik **multipart/form-data** met een **read stream**:

**Node.js voorbeeld (axios):**

```ts
import FormData from "form-data";
import fs from "fs";

const form = new FormData();
form.append("file", fs.createReadStream(localVideoPath), {
  filename: storedFilename,
  contentType: "video/mp4"
});

await axios.post(
  "https://app.yodeck.com/api/v2/media",
  form,
  {
    headers: {
      Authorization: `Token ${process.env.YODECK_AUTH_TOKEN}`,
      ...form.getHeaders()
    },
    maxBodyLength: Infinity,
    maxContentLength: Infinity
  }
);
```

**BELANGRIJK**

* âŒ NOOIT JSON sturen
* âŒ NOOIT `text/plain`
* âœ… ALTIJD `multipart/form-data`
* âœ… ALTIJD `fs.createReadStream`
* âœ… `maxBodyLength: Infinity`

---

## 2ï¸âƒ£ Stream direct uit Object Storage (beter)

Indien mogelijk:

* Stream **direct** vanuit object storage
* Niet eerst in memory laden

```ts
const videoStream = await objectStorage.createReadStream(storagePath);

form.append("file", videoStream, {
  filename: storedFilename,
  contentType: "video/mp4"
});
```

---

## 3ï¸âƒ£ Playlist publish flow (na upload)

Na succesvolle media upload:

1. Ontvang `mediaId` van Yodeck
2. Voeg toe aan juiste playlist:

```ts
POST /api/v2/playlists/{playlistId}/items
{
  "mediaId": mediaId
}
```

â¡ï¸ Check of media al bestaat in playlist (idempotent)
â¡ï¸ Zo ja: skip toevoegen

---

## 4ï¸âƒ£ Retry-veiligheid (ZEER BELANGRIJK)

* Als upload faalt:

  * markeer plan = `FAILED`
  * sla `lastError` op
* Bij â€œOpnieuw proberenâ€:

  * hergebruik bestaande media indien al geÃ¼pload
  * upload niet dubbel

---

## 5ï¸âƒ£ UI feedback (modal)

Wanneer upload faalt:

* Toon:

  > â€œUpload naar Yodeck mislukt (ongeldig media type).
  > Dit is een technische fout â€” je kunt veilig opnieuw proberen.â€

Knoppen:

* âœ… Opnieuw proberen
* ğŸ‘ Bekijk voorstel
* â¸ Later

---

## ACCEPTATIECRITERIA

* Yodeck upload gebeurt als `video/mp4`
* Geen `text/plain` errors meer
* Retry werkt zonder duplicaten
* Na succes staat video zichtbaar in Yodeck playlist
* Plan â†’ LIVE

---

**Dit is een blocker-fix. Deze wijziging heeft prioriteit boven alle UX-polish.**

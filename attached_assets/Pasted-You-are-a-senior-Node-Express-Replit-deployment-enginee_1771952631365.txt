You are a senior Node/Express + Replit deployment engineer. Our Replit build/publish is hanging and sometimes crashes with:
Error: listen EADDRINUSE: address already in use 0.0.0.0:5000

Goal: Make publish/deploy reliable and ensure ONLY one server process listens on the correct port. Do not refactor the app. Make minimal, targeted changes. Keep existing routes and integrations intact.

PHASE 1 — Diagnose (do this first, report findings)
1) Inspect package.json scripts (start/dev/build), Replit run/deploy commands, and any Procfile/replit config.
2) Search the repo for hardcoded port usage (":5000", "listen(5000", "PORT=5000", "0.0.0.0:5000").
3) Determine whether Replit is starting multiple processes (dev server + prod server, or watcher + runner).
4) Identify where “build hangs”: find last log line during deploy and which command is stuck (npm install, build, migrations, server boot, workers).

PHASE 2 — Fix (minimal changes)
A) Ensure the server ALWAYS listens on process.env.PORT (fallback only for local dev), e.g. const port = process.env.PORT || 5000.
B) Ensure deployment uses ONE entrypoint (single Node process). If current scripts run multiple commands in parallel, simplify for deploy only.
C) Add a startup guard/log: log the chosen PORT and environment (NODE_ENV) once at boot.
D) If any background workers (interval loops) are started during build/deploy phase (before server boot), ensure they only start after server is listening, or gate them behind an env flag for deploy if needed.

PHASE 3 — Verification
1) Provide exact steps/commands to verify no port conflict:
   - how to list which PID is using PORT in Replit (lsof/fuser alternative),
   - confirm server boot message appears once,
   - confirm deploy completes and app responds.
2) Provide a short checklist so we can repeat publish tests.

Output requirements:
- Show exactly which files you changed and the diff-like snippets.
- Explain the root cause you found (why EADDRINUSE happened and why build hung).
- Do NOT change unrelated business logic (Yodeck/Moneybird/R2 etc.).